# 스마트 현장관리 V7 - 전체 코드 확인 요약

## 1. 프로젝트 구조

| 파일 | 역할 |
|------|------|
| **index.html** | 메인 HTML. 메인/도면/보관함/견적/일정/세팅 화면 + 견적서·일정 PDF 모달. Bootstrap, include(css), include(js_*) |
| **code.js** | GAS 서버: doGet(웹앱 HTML 배포, downloadPdf), doPost(downloadPdfFromData, sendEstimateEmail), 시트·PDF·메일 |
| **css.html** | 공통 스타일. 견적서 미리보기 모달 푸터 항상 보이게 (#pdfPreviewModal) |
| **js_main.html** | 화면 전환(goScreen), 도면 화면 진입 시 초기화 |
| **js_drawing.html** | 도면 그리기(캔버스, 벽/가구/문, 저장 등) |
| **js_estimate.html** | 견적 내기: 단가표·체크박스·저장/불러오기, **PDF로 내보내기(exportEstimatePDF)** |
| **js_history.html** | 도면 보관함 목록·보기 |
| **js_schedule.html** | 일정 화면, 일정 PDF 미리보기 |
| **js_settings.html** | 관리자 세팅 |

---

## 2. 견적서 PDF 미리보기 흐름 (확인 완료)

### 2-1. 진입
- 견적 내기 화면 → **「PDF로 내보내기」** 클릭 → `exportEstimatePDF()` 호출

### 2-2. exportEstimatePDF() (js_estimate.html)
1. **HTML 생성**  
   - 표지(갑지) + 견적서 상세 내역 테이블만 있는 `html` 문자열 생성  
   - **본문(iframe) 안에는** 가로 인쇄 안내 문단·인쇄/닫기 버튼 **없음** (이미 제거된 상태)
2. **iframe용 HTML 정리** (4개 정규식)  
   - `print-hint` 클래스 `<p>` 제거  
   - `preview-actions` 클래스 `<div>` 제거  
   - "가로 인쇄" 포함 `<p>` 제거  
   - 인쇄+닫기 버튼 둘 다 있는 `<div>` 제거  
   → 예전에 남아 있을 수 있는 블록까지 제거
3. **모달 푸터 강제 설정**  
   - `pdfPreviewModal`의 `.modal-footer`를 **항상** 아래 4개 버튼으로 덮어씀:  
     **인쇄** | **PDF 저장** | **견적서 메일로** | **닫기**
4. iframe에 `html` 쓰기 → **인쇄·PDF저장·메일** 클릭 핸들러 연결 → `bootstrap.Modal` 표시

### 2-3. index.html의 견적서 모달
- `#pdfPreviewModal` 안에  
  - `#pdfPreviewIframe` (본문)  
  - `.modal-footer` (인쇄, PDF 저장, 견적서 메일로, 닫기)  
- **모달을 열 때마다** js_estimate에서 위 푸터를 **다시 채우므로**,  
  index가 예전 버전(버튼 2개)이어도 **인쇄 버튼 포함 4개**가 보이도록 되어 있음.

### 2-4. CSS (css.html)
- `#pdfPreviewModal`:  
  - `max-height: 100vh`, 본문 `flex: 1 1 auto`, 푸터 `flex: 0 0 auto`  
  → 푸터(인쇄·PDF저장·메일·닫기)가 **항상 화면 아래에 고정**되도록 설정됨.

---

## 3. 서버 (code.js)

- **doGet**  
  - `downloadPdf` + fileId/siteName → PDF JSON 또는 HTML  
  - 그 외 → `createTemplateFromFile('index').evaluate()` 로 웹앱 HTML 제공
- **doPost**  
  - `downloadPdfFromData=1&format=json` + POST body(견적 JSON) → PDF 생성 후 `{ chunks, name }` 반환  
  - `sendEstimateEmail=1&format=json` + POST body → PDF 생성 후 **limoonsa@gmail.com**으로 메일 발송, `{ ok, message }` 반환

---

## 4. 정리 (견적서 미리보기 기준)

- **index.html**: 견적서 모달에 인쇄·PDF 저장·견적서 메일로·닫기 4개 버튼 정의됨.
- **js_estimate.html**:  
  - PDF로 내보내기 시 **항상** 위 4개로 푸터를 덮어씀.  
  - iframe에 넣는 HTML에는 노란색 안내·본문 인쇄/닫기 없음.  
  - 4개 정규식으로 혹시 남은 구식 블록도 제거.
- **css.html**: 견적서 미리보기 푸터가 화면에 항상 보이도록 레이아웃 적용.

배포 후에도 **인쇄 버튼이 안 보이면**  
- 사용 중인 웹앱 URL이 **최신 배포 버전**인지,  
- **캐시/강력 새로고침(Ctrl+F5)** 또는 시크릿 창으로 다시 열었는지  
확인하는 것이 좋습니다.
